import{a as e,u as s,j as t}from"../index-CK06dqkR.js";import{_ as a,b as n,c as l,M as i,A as r,R as c,X as o,d,e as m,E as u,f as g,C as x,g as h,h as p,i as f,T as b}from"./ui-BN6vDYCP.js";import{c as j}from"./utils-CK2oMmzc.js";import{r as v}from"./vendor-PtCq8RB_.js";const y=j(((t,n)=>({messages:[],users:[],selectedUser:null,isUsersLoading:!1,isMessagesLoading:!1,replyingTo:null,typingUsers:{},typingTimeout:null,typingDebounceTime:1e3,getUsers:async(n=!1)=>{var l,i,r;n||t({isUsersLoading:!0});try{const a=await e.get("/messages/users-sidebar"),n=null==(l=s.getState().authUser)?void 0:l._id,i=a.data.map((e=>e.lastMessage&&e.lastMessage.senderId===n?{...e,unreadCount:0}:e));t({users:i})}catch(c){n||a.error((null==(r=null==(i=c.response)?void 0:i.data)?void 0:r.message)||"Failed to load contacts")}finally{n||t({isUsersLoading:!1})}},getMessages:async s=>{t({isMessagesLoading:!0});try{const a=await e.get(`/messages/${s}`);t({messages:a.data}),n().markMessagesAsSeen(s)}catch(l){a.error(l.response.data.message)}finally{t({isMessagesLoading:!1})}},markMessagesAsSeen:async a=>{try{await e.post(`/messages/${a}/seen`);const l=s.getState().socket;l&&l.emit("markMessagesAsSeen",{senderId:a});const{messages:i}=n(),r=i.map((e=>e.senderId!==a||e.seenAt?e:{...e,seenAt:(new Date).toISOString()}));t({messages:r}),n().getUsers(!0)}catch(l){}},sendMessage:async s=>{var l,i;const{selectedUser:r,messages:c,replyingTo:o}=n();o&&(s.replyToId=o._id);try{const a=await e.post(`/messages/${r._id}`,s);t({messages:[...c,a.data],replyingTo:null}),n().setUserTyping(!1),n().getUsers(!0)}catch(d){a.error((null==(i=null==(l=d.response)?void 0:l.data)?void 0:i.message)||"Failed to send message")}},editMessage:async(s,l)=>{var i,r;const{messages:c}=n();try{const i=await e.put(`/messages/${s}`,{text:l}),r=c.map((e=>e._id===s?i.data:e));t({messages:r}),a.success("Message updated"),n().getUsers(!0)}catch(o){a.error((null==(r=null==(i=o.response)?void 0:i.data)?void 0:r.message)||"Failed to edit message")}},deleteMessage:async s=>{var l,i;const{messages:r}=n();try{await e.delete(`/messages/${s}`);const l=r.map((e=>e._id===s?{...e,text:"This message was deleted",image:"",isDeleted:!0}:e));t({messages:l}),a.success("Message deleted"),n().getUsers(!0)}catch(c){a.error((null==(i=null==(l=c.response)?void 0:l.data)?void 0:i.message)||"Failed to delete message")}},addReaction:async(s,l)=>{var i,r;const{messages:c}=n();try{const a=await e.post(`/messages/${s}/react`,{emoji:l}),n=c.map((e=>e._id===s?a.data:e));t({messages:n})}catch(o){a.error((null==(r=null==(i=o.response)?void 0:i.data)?void 0:r.message)||"Failed to add reaction")}},setReplyingTo:e=>{t({replyingTo:e})},clearReplyingTo:()=>{t({replyingTo:null})},setUserTyping:e=>{const{selectedUser:a,typingTimeout:l,typingDebounceTime:i}=n(),r=s.getState().socket,c=s.getState().authUser;if(!(a&&r&&r.connected&&c))return;l&&clearTimeout(l);const o=setTimeout((()=>{r.emit("typing",{isTyping:e,receiverId:a._id})}),i);t({typingTimeout:o})},userIsTyping:e=>{var t;const{typingUsers:a}=n(),l=s.getState().authUser;return(null==l?void 0:l._id)!==e&&((null==(t=a[e])?void 0:t.isTyping)||!1)},subscribeToMessages:()=>{const{selectedUser:e}=n();if(!e)return;const a=s.getState().socket,l=s.getState().authUser;a&&l&&(a.io.opts.query||(a.io.opts.query={}),a.io.opts.query.username=l.username||l.fullName,a.on("newMessage",(s=>{s.senderId===e._id&&(t({messages:[...n().messages,s]}),n().updateTypingStatus(s.senderId,!1),n().markMessagesAsSeen(s.senderId))})),a.on("messagesSeen",(({messageIds:e,seenAt:s,senderId:a,receiverId:i})=>{if(a!==l._id)return;const{messages:r}=n(),c=r.map((e=>e.seenAt||e.senderId!==a||e.receiverId!==i?e:{...e,seenAt:s}));t({messages:c}),n().getUsers(!0)})),a.on("messageDeleted",(e=>{const{messages:s}=n(),a=s.map((s=>s._id===e?{...s,text:"This message was deleted",image:"",isDeleted:!0}:s));t({messages:a}),n().getUsers(!0)})),a.on("messageEdited",(e=>{const{messages:s}=n(),a=s.map((s=>s._id===e._id?e:s));t({messages:a}),n().getUsers(!0)})),a.on("messageReaction",(e=>{const{messages:s}=n(),a=s.map((s=>s._id===e._id?e:s));t({messages:a})})),a.on("userTyping",(({userId:e,username:s})=>{e!==l._id&&n().updateTypingStatus(e,!0)})),a.on("userStoppedTyping",(({userId:e})=>{e!==l._id&&n().updateTypingStatus(e,!1)})))},updateTypingStatus:(e,s)=>{const{typingUsers:a}=n();t({typingUsers:{...a,[e]:{isTyping:s,timestamp:Date.now()}}})},unsubscribeFromMessages:()=>{const e=s.getState().socket;e&&(e.off("newMessage"),e.off("messageDeleted"),e.off("messageEdited"),e.off("messageReaction"),e.off("userTyping"),e.off("userStoppedTyping"),e.off("messagesSeen"))},setSelectedUser:e=>{t({selectedUser:e,replyingTo:null,typingUsers:{}}),e&&setTimeout((()=>{n().markMessagesAsSeen(e._id)}),1e3)}}))),N=()=>{const e=Array(8).fill(null);return t.jsxs("aside",{className:"h-full w-20 lg:w-72 border-r border-base-300 \r\n    flex flex-col transition-all duration-200",children:[t.jsx("div",{className:"border-b border-base-300 w-full p-5",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(n,{className:"w-6 h-6"}),t.jsx("span",{className:"font-medium hidden lg:block",children:"Contacts"})]})}),t.jsx("div",{className:"overflow-y-auto w-full py-3",children:e.map(((e,s)=>t.jsxs("div",{className:"w-full p-3 flex items-center gap-3",children:[t.jsx("div",{className:"relative mx-auto lg:mx-0",children:t.jsx("div",{className:"skeleton size-12 rounded-full"})}),t.jsxs("div",{className:"hidden lg:block text-left min-w-0 flex-1",children:[t.jsx("div",{className:"skeleton h-4 w-32 mb-2"}),t.jsx("div",{className:"skeleton h-3 w-16"})]})]},s)))})]})},w=()=>{const{getUsers:e,users:a,selectedUser:i,setSelectedUser:r,isUsersLoading:c,userIsTyping:o}=y(),{onlineUsers:d,authUser:m}=s(),[u,g]=v.useState(!1),[x,h]=v.useState(""),[p,f]=v.useState(!1),b=v.useRef(null);v.useEffect((()=>(e().then((()=>{f(!0)})),b.current=setInterval((()=>{e(!0)}),3e4),()=>{b.current&&clearInterval(b.current)})),[e]);const j=a.filter((e=>{var s;if(u&&!d.includes(e._id))return!1;if(x){const t=e.fullName.toLowerCase(),a=(null==(s=e.username)?void 0:s.toLowerCase())||"",n=x.toLowerCase();return t.includes(n)||a.includes(n)}return!0}));return c&&!p?t.jsx(N,{}):t.jsxs("aside",{className:"h-full w-20 lg:w-80 border-r border-base-300 flex flex-col transition-all duration-200",children:[t.jsxs("div",{className:"border-b border-base-300 w-full p-5 space-y-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(n,{className:"size-6"}),t.jsx("span",{className:"font-medium hidden lg:block",children:"Contacts"})]}),t.jsxs("div",{className:"hidden lg:block relative",children:[t.jsx("input",{type:"text",className:"input input-sm input-bordered w-full pl-9",placeholder:"Search users...",value:x,onChange:e=>h(e.target.value)}),t.jsx(l,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-base-content/40"})]}),t.jsxs("div",{className:"hidden lg:flex items-center gap-2",children:[t.jsxs("label",{className:"cursor-pointer flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",checked:u,onChange:e=>g(e.target.checked),className:"checkbox checkbox-sm"}),t.jsx("span",{className:"text-sm",children:"Show online only"})]}),t.jsxs("span",{className:"text-xs text-zinc-500",children:["(",d.filter((e=>e!==(null==m?void 0:m._id))).length," online)"]})]})]}),t.jsx("div",{className:"overflow-y-auto w-full py-3",children:j.length>0?j.map((e=>{const s=d.includes(e._id)&&!e.hideStatus,a=o(e._id),n=e.unreadCount>0;return t.jsxs("button",{onClick:()=>r(e),className:`\n                  w-full px-3 py-3 flex items-center gap-3\n                  hover:bg-base-300 transition-colors relative\n                  ${(null==i?void 0:i._id)===e._id?"bg-base-300 ring-1 ring-base-300":""}\n                  ${n?"bg-base-200":""}\n                `,children:[t.jsxs("div",{className:"relative mx-auto lg:mx-0",children:[t.jsx("img",{src:e.profilePic||"/avatar.png",alt:e.name,className:"size-12 object-cover rounded-full"}),s&&t.jsx("span",{className:"absolute bottom-0 right-0 size-3 bg-green-500 \r\n                      rounded-full ring-2 ring-zinc-900"})]}),t.jsxs("div",{className:"hidden lg:block text-left min-w-0 flex-1",children:[t.jsxs("div",{className:"font-medium truncate flex items-center justify-between",children:[t.jsx("span",{children:e.fullName}),n&&t.jsx("span",{className:"badge badge-sm badge-primary ml-2",children:e.unreadCount})]}),t.jsxs("div",{className:"text-xs text-zinc-400 truncate",children:["@",e.username]}),a&&t.jsx("div",{className:"text-sm text-zinc-400 truncate",children:t.jsxs("span",{className:"flex items-center gap-1 text-green-500",children:[t.jsx("span",{className:"animate-pulse",children:"Typing"}),t.jsx("span",{className:"typing-dots",children:"..."})]})})]}),n&&t.jsx("span",{className:"lg:hidden absolute top-1 right-1 badge badge-xs badge-primary",children:e.unreadCount})]},e._id)})):t.jsx("div",{className:"text-center text-zinc-500 py-4",children:x?"No users found":"No contacts available"})}),t.jsx("style",{jsx:"true",children:'\n        @keyframes typing {\n          0% { content: ""; }\n          25% { content: "."; }\n          50% { content: ".."; }\n          75% { content: "..."; }\n          100% { content: ""; }\n        }\n        .typing-dots::after {\n          content: "";\n          animation: typing 1.5s infinite ease-in-out;\n        }\n      '})]})},k=()=>t.jsx("div",{className:"flex-1 flex flex-col justify-center items-center p-4 bg-base-200/50",children:t.jsxs("div",{className:"text-center max-w-md",children:[t.jsx("div",{className:"inline-flex items-center justify-center size-16 bg-base-300 rounded-full mb-4",children:t.jsx(i,{className:"size-8 text-primary/70"})}),t.jsx("h3",{className:"text-xl font-bold mb-2",children:"Your Messages"}),t.jsx("p",{className:"text-base-content/70 text-sm md:text-base",children:"Select a contact to start chatting. Your conversations will appear here."})]})});function S(e){const s=new Date-new Date(e),t=Math.floor(s/1e3);if(t<60)return"just now";const a=Math.floor(t/60);if(a<60)return`${a} ${1===a?"minute":"minutes"} ago`;const n=Math.floor(a/60);if(n<24)return`${n} ${1===n?"hour":"hours"} ago`;const l=Math.floor(n/24);if(l<7)return`${l} ${1===l?"day":"days"} ago`;const i=Math.floor(l/7);if(i<4)return`${i} ${1===i?"week":"weeks"} ago`;const r=Math.floor(l/30);if(r<12)return`${r} ${1===r?"month":"months"} ago`;const c=Math.floor(l/365);return`${c} ${1===c?"year":"years"} ago`}const T=({isTyping:e})=>{const{selectedUser:a,setSelectedUser:n}=y(),{onlineUsers:l}=s(),i=!!a&&(l.includes(a._id)&&!a.hideStatus);return t.jsxs("div",{className:"p-3 flex items-center gap-3 border-b border-base-300",children:[t.jsx("button",{className:"md:hidden btn btn-sm btn-ghost",onClick:()=>n(null),children:t.jsx(r,{size:20})}),t.jsxs("div",{className:"relative",children:[t.jsx("img",{src:(null==a?void 0:a.profilePic)||"/avatar.png",alt:"profile pic",className:"size-12 rounded-full object-cover"}),i&&t.jsx("span",{className:"absolute bottom-0 right-0 size-3 bg-green-500 rounded-full ring-2 ring-zinc-900"})]}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-semibold",children:null==a?void 0:a.fullName}),t.jsx("div",{className:"text-xs text-base-content/70 flex items-center",children:e?t.jsxs("span",{className:"flex items-center gap-1 text-green-500",children:[t.jsx("span",{className:"animate-pulse",children:"Typing"}),t.jsx("span",{className:"dot-animate",children:"..."})]}):i?"Online":(null==a?void 0:a.lastSeen)?t.jsxs(t.Fragment,{children:["Last seen ",S(a.lastSeen)]}):"Offline"})]})]})},_=()=>{const[e,n]=v.useState(""),[l,i]=v.useState(null),[r,x]=v.useState(null),[h,p]=v.useState(!1),f=v.useRef(null),b=v.useRef(null),[j,N]=v.useState(!1),{sendMessage:w,replyingTo:k,clearReplyingTo:S,setUserTyping:T}=y(),{isUpdatingProfile:_,authUser:U,selectedUser:M}=s();v.useEffect((()=>{k&&b.current&&b.current.focus()}),[k]);const I=async s=>{if(s.preventDefault(),e&&e.trim()||l)if(h)a.error("Please wait for the image to finish processing");else try{await w({text:e,image:l}),n(""),i(null),x(null),T(!1)}catch(t){a.error("Failed to send message. Please try again.")}};return t.jsxs("form",{onSubmit:I,className:"p-3 border-t border-base-300 bg-base-100",children:[k&&t.jsxs("div",{className:"mb-2 p-2 rounded bg-base-200 flex items-start justify-between",children:[t.jsxs("div",{className:"flex items-start gap-2 overflow-hidden",children:[t.jsx("div",{className:"p-1 bg-base-300 rounded flex-shrink-0",children:t.jsx(c,{size:14})}),t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsxs("p",{className:"text-xs font-medium",children:["Replying to ",k.senderId===(null==U?void 0:U._id)?"yourself":null==M?void 0:M.fullName]}),t.jsx("p",{className:"text-xs truncate text-base-content/70",children:k.text||(k.image?"Image":"Message")})]})]}),t.jsx("button",{type:"button",className:"text-base-content/50 hover:text-base-content",onClick:S,children:t.jsx(o,{size:14})})]}),t.jsxs("div",{className:"flex items-end gap-2",children:[r&&t.jsxs("div",{className:"relative mb-2 max-w-xs",children:[t.jsx("img",{src:r,alt:"Preview",className:"w-full h-32 object-cover rounded-md"}),t.jsx("button",{type:"button",className:"absolute top-1 right-1 bg-black/50 rounded-full p-1 text-white",onClick:()=>{i(null),x(null)},children:t.jsx(o,{size:16})})]}),t.jsxs("div",{className:"flex-1 flex items-end gap-1 bg-base-200 rounded-lg p-1",children:[t.jsxs("button",{type:"button",className:"btn btn-sm btn-ghost btn-circle",onClick:()=>document.getElementById("imageInput").click(),children:[t.jsx(d,{size:18}),t.jsx("input",{type:"file",id:"imageInput",className:"hidden",onChange:async e=>{const s=e.target.files[0];if(s)if(s.size>15728640)a.error("Image is too large (max 15MB)");else{p(!0);try{const e=new FileReader;e.readAsDataURL(s),e.onload=async()=>{const s=e.result;x(s);try{const e=await(async(e,s=1200,t=.7)=>new Promise((a=>{const n=new d;n.src=e,n.onload=()=>{const e=document.createElement("canvas"),l=Math.min(s,n.width),i=l/n.width,r=n.height*i;e.width=l,e.height=r,e.getContext("2d").drawImage(n,0,0,l,r);const c=e.toDataURL("image/jpeg",t);a(c)}})))(s);i(e),a.success("Image compressed successfully")}catch(t){i(s)}p(!1)},e.onerror=()=>{a.error("Error reading file"),p(!1)}}catch(t){a.error("Failed to process image"),p(!1)}f.current&&(f.current.value="")}},accept:"image/*"})]}),t.jsx("textarea",{value:e,onChange:e=>{n(e.target.value),""!==e.target.value.trim()?T(!0):T(!1)},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),I(e))},placeholder:"Type a message...",className:"flex-1 bg-transparent border-0 focus:ring-0 resize-none max-h-32 py-2 px-2 text-sm",rows:e.includes("\n")?2:1,ref:b}),t.jsxs("div",{className:"relative",children:[t.jsx("button",{type:"button",className:"btn btn-sm btn-ghost btn-circle",onClick:()=>N(!j),children:t.jsx(m,{size:18})}),j&&t.jsx("div",{className:"absolute bottom-full right-0 mb-2",children:t.jsx(u,{onEmojiClick:s=>{n(e+s.native)},lazyLoadEmojis:!0,theme:"light"})})]}),t.jsx("button",{type:"submit",className:`btn btn-sm ${e.trim()||l?"btn-primary":"btn-disabled"} rounded-full w-10 h-10 min-h-0 p-0 flex items-center justify-center`,disabled:!e.trim()&&!l,children:t.jsx(g,{size:18})})]})]})]})},U=()=>{const e=Array(6).fill(null);return t.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:e.map(((e,s)=>t.jsxs("div",{className:"chat "+(s%2==0?"chat-start":"chat-end"),children:[t.jsx("div",{className:"chat-image avatar",children:t.jsx("div",{className:"size-10 rounded-full",children:t.jsx("div",{className:"skeleton w-full h-full rounded-full"})})}),t.jsx("div",{className:"chat-header mb-1",children:t.jsx("div",{className:"skeleton h-4 w-16"})}),t.jsx("div",{className:"chat-bubble bg-transparent p-0",children:t.jsx("div",{className:"skeleton h-16 w-[200px]"})})]},s)))})},M=["👍","❤️","😂","😮","😢","🙏"],I=()=>{const{messages:e,getMessages:n,isMessagesLoading:l,selectedUser:i,subscribeToMessages:r,unsubscribeFromMessages:d,setReplyingTo:u,deleteMessage:g,editMessage:j,addReaction:N,userIsTyping:w,markMessagesAsSeen:k}=y(),{authUser:S}=s(),I=v.useRef(null),[z,C]=v.useState(null),[E,L]=v.useState(""),[A,D]=v.useState(null),[$,R]=v.useState(null),F=!!i&&w(i._id);v.useEffect((()=>(n(i._id),r(),()=>d())),[i._id,n,r,d]);const[P,H]=v.useState(!0),q=v.useRef(null),O=v.useRef(0);v.useEffect((()=>{if(e.length){if(0===O.current&&e.length>0)I.current&&I.current.scrollIntoView({behavior:"instant"});else if(e.length>O.current){const e=q.current,s=e&&e.scrollHeight-e.scrollTop-e.clientHeight<100;I.current&&s&&I.current.scrollIntoView({behavior:"smooth"})}O.current=e.length}}),[e]),v.useEffect((()=>{if(F&&I.current){const e=q.current;e&&e.scrollHeight-e.scrollTop-e.clientHeight<100&&I.current.scrollIntoView({behavior:"smooth"})}}),[F]),v.useEffect((()=>{const e=()=>{const e=q.current;if(!e)return;const s=e.scrollHeight-e.scrollTop-e.clientHeight<100;H(s)},s=q.current;return s&&s.addEventListener("scroll",e),()=>{s&&s.removeEventListener("scroll",e)}}),[]),v.useEffect((()=>{const e=()=>{P&&I.current&&I.current.scrollIntoView({behavior:"smooth"})},s=document.querySelectorAll(".chat-container img");return s.forEach((s=>{s.addEventListener("load",e)})),()=>{s.forEach((s=>{s.removeEventListener("load",e)}))}}),[e,P]),v.useEffect((()=>{if(i&&e.length>0){const e=()=>{"visible"===document.visibilityState&&k(i._id)},s=()=>{k(i._id)};k(i._id),document.addEventListener("visibilitychange",e);const t=document.querySelector(".chat-container");return t&&t.addEventListener("scroll",s),()=>{document.removeEventListener("visibilitychange",e),t&&t.removeEventListener("scroll",s)}}}),[i,e,k]);const V=()=>{C(null),L("")},B=async()=>{E.trim()?(await j(z._id,E),C(null),L("")):a.error("Message cannot be empty")},K=async(e,s)=>{await N(e,s),R(null)};if(l)return t.jsxs("div",{className:"flex-1 flex flex-col overflow-auto",children:[t.jsx(T,{}),t.jsx(U,{}),t.jsx(_,{})]});const Y=[...e].reverse().find((e=>e.senderId===S._id&&!e.isDeleted));return t.jsxs("div",{className:"flex-1 flex flex-col overflow-auto",children:[t.jsx(T,{isTyping:F}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 chat-container",ref:q,children:[!P&&e.length>10&&t.jsx("button",{className:"btn btn-sm btn-primary fixed bottom-20 right-4 z-10 rounded-full shadow-md",onClick:()=>{I.current&&(I.current.scrollIntoView({behavior:"smooth"}),H(!0))},children:t.jsx("span",{children:"↓ Latest Messages"})}),e.map(((s,n)=>{const l=s.senderId===S._id,r=(e=>{const s={};return e.forEach((e=>{s[e.emoji]=(s[e.emoji]||0)+1})),s})(s.reactions||[]),d=e=>{var t;return null==(t=s.reactions)?void 0:t.some((s=>s.userId===S._id&&s.emoji===e))},j=s.replyTo?e.find((e=>e._id===s.replyTo._id))||s.replyTo:null,v=Y&&Y._id===s._id;return t.jsxs("div",{className:"chat "+(l?"chat-end":"chat-start"),ref:n===e.length-1?I:null,children:[t.jsx("div",{className:"chat-image avatar",children:t.jsx("div",{className:"size-10 rounded-full border",children:t.jsx("img",{src:l?S.profilePic||"/avatar.png":i.profilePic||"/avatar.png",alt:"profile pic"})})}),t.jsxs("div",{className:"chat-header mb-1 flex items-center gap-2",children:[t.jsxs("time",{className:"text-xs opacity-50 ml-1",children:[(y=s.createdAt,new Date(y).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1})),s.isEdited&&t.jsx("span",{className:"ml-1",children:"(edited)"})]}),l&&v&&t.jsxs("span",{className:"text-xs flex items-center gap-0.5 text-primary opacity-80",children:[t.jsx(x,{size:12,className:s.seenAt?"fill-primary":""}),s.seenAt?"Seen":"Sent"]})]}),z&&z._id===s._id?t.jsxs("div",{className:"chat-bubble flex flex-col p-2",children:[t.jsx("textarea",{className:"textarea textarea-bordered w-full mb-2",value:E,onChange:e=>L(e.target.value),autoFocus:!0}),t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx("button",{onClick:V,className:"btn btn-sm btn-ghost",children:"Cancel"}),t.jsx("button",{onClick:B,className:"btn btn-sm btn-primary",children:"Save"})]})]}):t.jsxs("div",{className:"relative group",children:[j&&t.jsxs("div",{className:"chat-bubble chat-bubble-info p-2 mb-1 opacity-70",children:[t.jsxs("div",{className:"text-xs font-medium mb-1",children:["Replying to ",j.senderId===S._id?"yourself":i.fullName]}),t.jsx("p",{className:"text-sm truncate",children:j.text||(j.image?"Image":"Message")})]}),t.jsxs("div",{className:"chat-bubble flex flex-col relative",children:[s.image&&t.jsx("img",{src:s.image,alt:"Attachment",className:"sm:max-w-[200px] rounded-md mb-2"}),s.isDeleted?t.jsxs("div",{className:"flex items-center gap-2 italic opacity-60",children:[t.jsx(h,{size:14}),t.jsx("span",{children:s.text})]}):t.jsx("p",{children:s.text}),!s.isDeleted&&t.jsxs("div",{className:`\n                          absolute ${l?"left-0":"right-0"} top-0 -m-2\n                          opacity-0 group-hover:opacity-100 transition-opacity\n                          flex gap-1\n                        `,children:[t.jsx("button",{onClick:()=>{return e=s._id,R($===e?null:e),void D(null);var e},className:"btn btn-circle btn-xs bg-base-100",children:t.jsx(m,{size:12})}),t.jsx("button",{onClick:()=>(e=>{u(e),D(null)})(s),className:"btn btn-circle btn-xs bg-base-100",children:t.jsx(c,{size:12})}),l&&t.jsx("button",{onClick:()=>{return e=s._id,D(A===e?null:e),void R(null);var e},className:"btn btn-circle btn-xs bg-base-100",children:t.jsx(p,{size:12})})]}),$===s._id&&t.jsxs("div",{className:"absolute top-0 -mt-10 bg-base-200 rounded-full px-2 py-1 flex gap-1 shadow-lg",children:[M.map((e=>t.jsx("button",{onClick:()=>K(s._id,e),className:"text-lg hover:scale-125 transition-transform "+(d(e)?"opacity-50":"opacity-100"),children:e},e))),t.jsx("button",{onClick:()=>R(null),className:"ml-1 text-base-content/50 hover:text-base-content",children:t.jsx(o,{size:14})})]}),A===s._id&&t.jsxs("div",{className:"absolute top-0 -mt-20 right-0 bg-base-200 rounded-lg shadow-lg overflow-hidden",children:[t.jsxs("button",{onClick:()=>(e=>{(Date.now()-new Date(e.createdAt))/1e3>900?a.error("Messages can only be edited within 15 minutes of sending"):(C(e),L(e.text||""),D(null))})(s),className:"flex items-center gap-2 px-3 py-2 w-full hover:bg-base-300 text-left",children:[t.jsx(f,{size:14}),t.jsx("span",{children:"Edit"})]}),t.jsxs("button",{onClick:()=>(async e=>{await g(e),D(null)})(s._id),className:"flex items-center gap-2 px-3 py-2 w-full hover:bg-base-300 text-left text-error",children:[t.jsx(b,{size:14}),t.jsx("span",{children:"Delete"})]})]})]}),Object.keys(r).length>0&&t.jsx("div",{className:"chat-footer opacity-75 flex flex-wrap gap-1 mt-1",children:Object.entries(r).map((([e,a])=>t.jsxs("button",{onClick:()=>K(s._id,e),className:"bg-base-200 rounded-full px-1.5 py-0.5 text-xs flex items-center gap-1 hover:bg-base-300 "+(d(e)?"ring-1 ring-primary/30":""),children:[t.jsx("span",{children:e}),t.jsx("span",{children:a})]},e)))})]})]},s._id);var y})),F&&t.jsxs("div",{className:"chat chat-start",ref:I,children:[t.jsx("div",{className:"chat-image avatar",children:t.jsx("div",{className:"size-10 rounded-full border",children:t.jsx("img",{src:i.profilePic||"/avatar.png",alt:"profile pic"})})}),t.jsxs("div",{className:"chat-bubble chat-bubble-info flex gap-1 items-center py-2 px-4 min-h-0",children:[t.jsx("span",{className:"typing-dot"}),t.jsx("span",{className:"typing-dot"}),t.jsx("span",{className:"typing-dot"}),t.jsx("style",{jsx:"true",children:"\n                .typing-dot {\n                  width: 6px;\n                  height: 6px;\n                  border-radius: 50%;\n                  background-color: currentColor;\n                  animation: typingAnimation 1.5s infinite ease-in-out;\n                }\n                .typing-dot:nth-child(2) {\n                  animation-delay: 0.5s;\n                }\n                .typing-dot:nth-child(3) {\n                  animation-delay: 1s;\n                }\n                @keyframes typingAnimation {\n                  0% { opacity: 0.2; transform: scale(0.8); }\n                  50% { opacity: 1; transform: scale(1.1); }\n                  100% { opacity: 0.2; transform: scale(0.8); }\n                }\n              "})]})]})]}),t.jsx(_,{})]})},z=()=>{const{selectedUser:e}=y();return t.jsx("div",{className:"min-h-screen bg-base-200",children:t.jsx("div",{className:"flex items-center justify-center pt-4 md:pt-16 px-2 sm:px-4",children:t.jsx("div",{className:"bg-base-100 rounded-lg shadow-lg w-full h-[calc(100vh-2rem)] md:h-[calc(100vh-6rem)] md:max-w-6xl overflow-hidden",children:t.jsxs("div",{className:"flex h-full rounded-lg overflow-hidden",children:[t.jsx("div",{className:""+(e?"hidden md:block":"block"),children:t.jsx(w,{})}),e?t.jsx("div",{className:"flex-1 flex flex-col",children:t.jsx(I,{})}):t.jsx(k,{})]})})})})};export{z as default};
